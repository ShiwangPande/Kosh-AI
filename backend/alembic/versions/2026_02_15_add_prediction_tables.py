"""add prediction tables

Revision ID: 6636e5a065ca
Revises: ac826f6f4e96
Create Date: 2026-02-15 09:44:53.652964+00:00

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = '6636e5a065ca'
down_revision: Union[str, None] = 'ac826f6f4e96'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('demand_predictions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('merchant_id', sa.UUID(), nullable=True),
    sa.Column('product_id', sa.UUID(), nullable=True),
    sa.Column('target_date', sa.Date(), nullable=True),
    sa.Column('expected_quantity', sa.Float(), nullable=True),
    sa.Column('confidence_score', sa.Float(), nullable=True),
    sa.Column('explanation', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['merchant_id'], ['merchants.id'], ),
    sa.ForeignKeyConstraint(['product_id'], ['products.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_demand_predictions_merchant_id'), 'demand_predictions', ['merchant_id'], unique=False)
    op.create_table('price_predictions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('product_id', sa.UUID(), nullable=True),
    sa.Column('city', sa.String(length=100), nullable=True),
    sa.Column('target_date', sa.Date(), nullable=True),
    sa.Column('predicted_price', sa.Float(), nullable=True),
    sa.Column('confidence_score', sa.Float(), nullable=True),
    sa.Column('trend_direction', sa.String(length=20), nullable=True),
    sa.Column('explanation', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['product_id'], ['products.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_price_predictions_city'), 'price_predictions', ['city'], unique=False)
    op.create_index(op.f('ix_price_predictions_product_id'), 'price_predictions', ['product_id'], unique=False)
    op.create_index(op.f('ix_price_predictions_target_date'), 'price_predictions', ['target_date'], unique=False)
    op.create_table('restock_predictions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('merchant_id', sa.UUID(), nullable=True),
    sa.Column('product_id', sa.UUID(), nullable=True),
    sa.Column('recommended_date', sa.Date(), nullable=True),
    sa.Column('recommended_quantity', sa.Float(), nullable=True),
    sa.Column('urgency_score', sa.Float(), nullable=True),
    sa.Column('explanation', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['merchant_id'], ['merchants.id'], ),
    sa.ForeignKeyConstraint(['product_id'], ['products.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_restock_predictions_merchant_id'), 'restock_predictions', ['merchant_id'], unique=False)
    op.create_table('supplier_risk_predictions',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('supplier_id', sa.UUID(), nullable=True),
    sa.Column('risk_type', sa.String(length=50), nullable=True),
    sa.Column('probability', sa.Float(), nullable=True),
    sa.Column('risk_score', sa.Float(), nullable=True),
    sa.Column('explanation', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.ForeignKeyConstraint(['supplier_id'], ['suppliers.id'], ),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_supplier_risk_predictions_supplier_id'), 'supplier_risk_predictions', ['supplier_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_supplier_risk_predictions_supplier_id'), table_name='supplier_risk_predictions')
    op.drop_table('supplier_risk_predictions')
    op.drop_index(op.f('ix_restock_predictions_merchant_id'), table_name='restock_predictions')
    op.drop_table('restock_predictions')
    op.drop_index(op.f('ix_price_predictions_target_date'), table_name='price_predictions')
    op.drop_index(op.f('ix_price_predictions_product_id'), table_name='price_predictions')
    op.drop_index(op.f('ix_price_predictions_city'), table_name='price_predictions')
    op.drop_table('price_predictions')
    op.drop_index(op.f('ix_demand_predictions_merchant_id'), table_name='demand_predictions')
    op.drop_table('demand_predictions')
    # ### end Alembic commands ###
